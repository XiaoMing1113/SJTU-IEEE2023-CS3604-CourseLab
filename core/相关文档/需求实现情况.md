# 层次化需求分析树 [汇总简表]

## 顺序化功能明细（按页面分组）

1. 首页 (P001)
   1.1 导航栏访问 (F001)
   - "导航栏固定顶部"
   - "未登录显示登录/注册入口"
   - "已登录显示用户名与头像"
   - "主要功能入口：首页、查询、个人中心"
   - "点击登录按钮跳转登录页 P003"
   - "点击注册按钮跳转注册页 P004"
   - "点击用户名显示下拉菜单（个人中心、退出登录）"
   - "当前页面对应入口高亮"
   - "登录态过期自动跳转登录页"
   
   1.2 快捷入口访问 (F002)
   - "常用功能卡片：车票查询、订单查询、改签退票"
   - "个性化推荐（已登录用户显示）"
   - "历史查询记录最多显示 5 条"
   - "点击车票查询跳转 P002"
   - "点击订单查询跳转 P006（订单管理）"
   - "点击历史记录自动填充查询条件"
   - "清除历史记录需确认弹窗"
   - "未登录仅显示基础功能入口"
   - "推荐加载失败时降级显示默认入口"

2. 车票查询页 (P002)

   2.1 车票查询 (F003)
   - "出发地/目的地支持模糊搜索（拼音/中文）"（x）
   - "显示热门城市列表"（x）
   - "显示最近搜索记录（最多 3 条）"（x）
   - "支持一键互换出发地与目的地"（√）
   - "日期选择器支持 30 天内日期"（部分完成）
   - "快捷日期选择：今天、明天、后天"（x）
   - "日期显示星期几"（√）
   - "禁用过去日期"（部分完成）
   - "车次类型筛选（高铁/动车/普快）"（√，通过前缀 G/D/Z/T/K）
   - "出发时间段筛选"（√）
   - "仅显示有票选项"（部分完成）
   - "验证必填项完整性（出发地、目的地、日期）"（部分完成）
   - "提交查询请求并显示加载状态"（√）
   - "接收并解析返回数据"（√）
   - "渲染车次列表并联动车次筛选（F004）"（√）
   - "显示车次信息：车次号、发到站、时间、历时"（√）
   - "显示余票信息：各席别余票数量"（√）
   - "显示票价信息：各席别价格"（√）
   - "特殊标识：始发站、经停站、可改签"（部分完成，始/终标识 √）
   - "直达无结果时推荐中转方案"（x）
   - "出发地与目的地相同提示错误"（x）
   - "未选择日期时默认设置为今天"（√）
   - "接口超时提示重试"（部分完成）
   - "网络异常时显示缓存结果（若有）"（x）

   2.2 车次筛选 (F004)
   - "车次类型筛选：高铁（G）"（√）
   - "车次类型筛选：动车（D）与城际（C）"（√，D；C暂未单列，含时可扩展）
   - "车次类型筛选：特快（T）与快速（K）"（√）
   - "车次类型筛选：普快（其他类型）"（部分完成）
   - "车次类型支持多选"（√）
   - "出发时间段：凌晨（00:00-06:00）"（√）
   - "出发时间段：上午（06:00-12:00）"（√）
   - "出发时间段：下午（12:00-18:00）"（√）
   - "出发时间段：晚上（18:00-24:00）"（√）
   - "席别筛选：商务座、一等座、二等座、硬卧、软卧、硬座"（部分完成，现有商/一/二）
   - "席别筛选时可仅显示有票席别"（√）
   - "出发/到达车站筛选（多站点城市）"（√）
   - "始发站优先标识"（√）
   - "高级筛选：历时范围（滑块选择）"（x）
   - "高级筛选：价格区间"（x）
   - "高级筛选：可改签/可退票"（x）
   - "实时过滤车次列表"（√）
   - "显示筛选结果数量"（√）
   - "多条件 AND 逻辑组合"（√）
   - "筛选结果为空时提示放宽条件"（部分完成）

   2.3 车票预订 (F005)
   - "验证登录状态，未登录跳转登录页 P003"（部分完成）
   - "检查余票数量"（√）
   - "验证乘车人信息完整性"（√）
   - "显示锁票时间提示（通常 15 分钟）"（x）
   - "显示可用席别及余票"（√）
   - "选择席别及购票数量"（部分完成，选择席别 √，数量 x）
   - "席别介绍悬浮提示"（x）
   - "票价实时计算"（√）
   - "加载常用乘车人列表（来自乘客管理）"（√）
   - "乘车人多选支持（最多 5 人）"（部分完成，支持多选但未限制上限）
   - "快速添加新乘车人"（部分完成）
   - "证件类型适配（身份证/护照等）"（部分完成，现为身份证）
   - "证件有效期校验"（x）
   - "显示订单明细：车次、席别、乘车人、总价"（部分完成）
   - "勾选购票协议后方可提交"（x）
   - "提交预订请求，锁票成功跳转 P005"（√）
   - "余票不足提示选择其他席别或车次"（√）
   - "网络中断保存草稿并支持稍后恢复"（x）

   2.4 中转换乘查询 (F006)
   - "直达车次查询无结果时自动推荐中转"（x）
   - "用户可主动选择中转方案"（x）
   - "显示预计可节省时间与费用"（x）
   - "查询可用中转站（主要枢纽站）"（x）
   - "计算换乘时间（最少 30 分钟，最多 4 小时）"（x）
   - "生成多个中转方案（最多 5 个）"（x）
   - "按总历时与总价排序"（x）
   - "方案展示：第一程车次、时间、价格"（x）
   - "方案展示：中转站的换乘时间与站内导航提示"（x）
   - "方案展示：第二程车次、时间、价格"（x）
   - "方案展示：总历时、总价、换乘次数"（x）
   - "风险提示：建议换乘时间与晚点风险"（x）
   - "预订流程：选择方案分别预订两段车票（串行）"（x）
   - "第一段成功后自动预订第二段"（x）
   - "无可用中转方案提示选择其他日期"（x）
   - "换乘时间不足警告提示用户"（x）

3. 登录页 (P003)
   3.1 用户登录 (F007)
   - "账号密码登录：支持用户名、手机号、邮箱输入"（√）
   - "密码输入支持显示/隐藏切换"（√）
   - “账户不存在提示用户注册”（？目前只有登录失败，请重试）
   - "连续失败≥3 次启用图形验证码"（x，目前不准备实现）
   - “忘记密码功能”（√）
   - "忘记密码第一层检测输出的邮箱/手机号——身份证组合是否在数据库中"（√）
   - “忘记密码第二次使用验证码检验”（√）
   - "登录成功跳转首页 P001"（√）

4. 注册页 (P004)
   4.1 用户注册 (F008)
   - "手机号 11 位格式验证"（√）
   - "检查手机号, 邮箱号，身份证号是否已注册"（√）
   - "发送验证码并显示 60 秒倒计时"（√）
   - "验证码为 6 位数字，5 分钟有效期"（？，有效期待定）
   - "验证码验证成功后才可继续"（√）
   - "重新发送验证码后上个验证码失效"（√）
   - "密码设置 6-20 位字符"（√）
   - "密码必须包含字母与数字"（x，可后续实现）
   - "密码强度提示（弱/中/强）"（√）
   - "身份证号码检验"（√）
   - "确认密码二次验证"（√）
   - "前端数据验证后由后端创建账户"（√）
   - "注册成功信息提示（跳转登录页）"（√）

5. 订单填写页 (P005)

   5.1 订单填写 (F009)
   - "显示车次信息：车次号、发到站、时间"（√）
   - "显示席别与数量"（√）
   - "显示票价明细"（部分完成）
   - "显示车票余量"（√）
   - "显示已选乘车人列表（来自预订流程）"（√）
   - "席位选择：二等座、一等座、商务座"（√）
   - “使用乘车人信息快捷”（√）
   - "订单倒计时 15 分钟并实时显示剩余时间"（x）
   - "少于 5 分钟时显示红色警告"（x）
   - "超时自动释放座位并提示重新预订"（x）
   - "票种选择：成人票、儿童票、学生票"（x）
   - "联系人手机号为必填，默认使用当前用户手机号"（x）
   - "临时保存草稿，刷新页面可恢复"（x）
   
   5.2 提交订单 (F010)
   - "检查所有必填项完整性"（√）
   - "验证证件号格式正确"（√）
   - "确认订单未超时"（x）
   - "检查余票是否仍然充足"（√）
   - "计算总价（含保险等）"（部分完成）
   - "生成唯一订单号"（√）
   - "锁定座位资源"（√）
   - "创建订单记录并关联乘车人信息"（√）
   - "设置支付超时时间为 30 分钟"（x）
   - "重复提交防抖处理（提交后禁用按钮）"（x）

6. 个人中心 (P006)
   6.1 个人信息管理 (F011)
   - 显示基本信息：用户名（不可修改） √
   - 显示真实姓名 √
   - 显示身份证号 √
   - 显示手机号 √
   - 显示邮箱 √
   - 显示账户信息：注册时间与最后登录时间 √
   - 显示账户等级与积分 x, 没必要
   - 显示实名认证状态 x, 没必要
   - 修改密码：输入旧密码 √
   - 修改密码：输入新密码（强度验证）并确认 √

   6.2 乘客管理 (F012)
   - 显示所有常用乘车人列表 √
   - 乘车人卡片显示：姓名、证件类型与号码 √
   - 旅客类型：成人/儿童/学生 √
   - 设为默认、编辑、删除按钮 √
   - 默认乘车人标识 √
   - 新增乘车人：输入基本信息 仅中文姓名 √
   - 新增乘车人：选择证件类型（身份证） √
   - 新增乘车人：填写证件号码及手机号 √
   - 证件校验：身份证 18 位格式与校验位验证 √（后端校验）
   - 证件校验：护照/通行证格式验证 √（后端校验）
   - 实时验证反馈 x

   6.3 订单管理 (F013)
   - 订单状态筛选：全部、待支付、已支付、已完成、已取消（未完成） √
   - 时间范围筛选：近一个月、三个月、半年、自定义 x
   - 搜索框支持订单号与车次号 x
   - 订单卡片显示订单号 √
   - 订单卡片显示车次信息（出发地→目的地） √
   - 订单卡片显示出发时间 √
   - 订单卡片显示乘车人姓名 √
   - 订单卡片显示金额与状态标签 √
   - 订单卡片提供操作按钮（随状态变化） √
   - 按创建时间倒序（默认） √
   - 分页每页显示 10 条 x（后端支持分页，前端未提供分页控件）
   - 点击订单卡片可展开详情 √
   - 待支付：立即支付跳转支付流程 √
   - 待支付：取消订单需确认弹窗 √

   6.4 订单支付 (F014)
   - "支付方式：微信扫码支付（PC）"（√）
   - "支付方式：微信 APP 内支付（移动端）"（x）
   - "支付方式：支付宝扫码支付（PC）"（√）
   - "支付方式：支付宝 APP 内支付（移动端）"（x）
   - "支付方式：银行卡快捷支付（已绑卡）"（x）
   - "支付方式：网银支付与添加新卡"（x）
   - "支付确认显示订单号"（√）
   - "支付确认显示订单金额与优惠信息"（部分完成）
   - "支付倒计时 30 分钟"（x）
   - "创建支付订单"（√）
   - "调起支付接口并跳转第三方支付页面"（部分完成）
   - "轮询支付状态（最多 3 分钟）"（x）
   - "支付成功后更新订单状态"（√）
   - "显示支付成功页面"（部分完成）
   - "显示支付失败原因"（部分完成）
   
   6.5 车票改签 (F015)（X）
   - "资格校验：订单为已支付且未使用"（x）
   - "资格校验：部分车票不可改签"（x）
   - "资格校验：检查改签次数（限改签 1 次）"（x）
   - "资格校验：检查时间限制（开车前 30 分钟）"（x）
   - "显示改签规则说明"（x）
   - "默认显示同一路线车次"（x）
   - "筛选条件：日期范围（前后 3 天）"（x）
   - "显示可改签车次与余票信息"（x）
   - "差价计算：补差价、退差价或无需补退"（x）
   - "确认改签协议并提交改签请求"（x）
   - "改签成功显示新订单信息并将原订单标记为已改签"（x）
   - "新车次余票不足提示选择其他车次"（x）
   
   6.6 用户登出 (F016)
   - "触发方式：点击导航栏退出登录"（√）
   - "触发方式：个人中心安全退出"（x）
   - "登出确认弹窗（可选）"（x）
   - "清除本地 token"（√）
   - "清除 session 及用户缓存信息"（√）
   - "记录登出日志并通知后端使 token 失效"（x）
   - "跳转首页并更新导航栏状态"（√）
   - "网络异常时本地强制登出"（√）
