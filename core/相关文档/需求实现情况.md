# 层次化需求分析树 [汇总简表]

## 顺序化功能明细（按页面分组）

1. 首页 (P001)
   1.1 导航栏访问 (F001)
   - "导航栏固定顶部" (√)
   - "未登录显示登录/注册入口" (√)
   - "已登录显示用户名与头像" (√)
   - "主要功能入口：首页、车牌、我的12306(个人中心)" (√)
   - "用户名左侧提供退出按钮退出登录功能"（√）（见F013）
   - "当前页面对应入口可互动高亮" (√)
   - "登录态过期自动跳转登录页" (√)
   - "点击车牌跳转车牌查询页 P002" (√)
   - "点击登录按钮跳转登录页 P003" (√)
   - "点击注册按钮跳转注册页 P004" (√)
   - "点击我的12306跳转个人中心页 P006" (√)
   
   1.2 快捷车票查询 (F002)
   - "交换出发地和目的地功能"（√）
   - "提供辅助搜索热门城市/拼音索引"（√）
   - "日期限制：15天内查询"（√）
   - "信息不全时点击查询按钮提示错误"（√）
   - "信息全时点击查询按钮跳转P002并保持相关查询参数"（√）


2. 车票查询页 (P002)

   2.1 车票查询 (F003)
   - "显示热门城市列表"（√）
   - "提供出发地/目的地辅助搜索（热门城市/拼音索引）"（√）
   - "支持一键互换出发地与目的地"（√）
   - "日期选择器支持 15 天内日期"（√）
   - "日期支持横向导航栏，且使用容纳7项日期，支持箭头跳转和点击跳转"（√）
   - "日期显示星期几"（√）
   - "禁用过去日期"（√）
   - "出发时间段筛选"（√）
   - "验证必填项完整性（出发地、目的地、日期）"（√）
   - "提交查询请求并显示加载状态"（√）
   - "接收并解析返回数据"（√）
   - "未选择日期时默认设置为今天"（√）
   - "缓存查询结果，后续再次跳转到本界面保持当前查询的出发地目的地和日期"（√）
   - "高级筛选：车次类型筛选：高铁（G）动车（D）城际（C）特快（T）快速（K）"（√）
   - "高级筛选：全时间段(00:00-24:00) 凌晨（00:00-06:00）上午（06:00-12:00）下午（12:00-18:00）晚上（18:00-24:00）"（√）
   - "高级筛选：席别筛选：商务座、一等座、二等座、硬卧、软卧、硬座"（部分完成，现有商/一/二）
   - "高级筛选：出发/到达车站筛选"（√）
   - "高级筛选支持多选"（√）
   - "席别筛选时可仅显示有票席别"（√）

   - "出发地/目的地支持模糊搜索（拼音/中文）"（x）
   - "出发地与目的地相同提示错误"（x）
   - "接口超时提示重试"（部分完成）
   - "网络异常时显示缓存结果（若有）"（x）

   2.2 车票展示 (F004)
   - "显示车次信息：车次号、发到站、时间、历时"（√）
   - "显示余票信息：各席别余票数量"（√）
   - "显示筛选结果数量"（√）
   - "未登录情况下点击预定按钮后跳转P003登录页"（√）  
   - "点击车票后的预定按钮后跳转P005"（√）

   - "显示票价信息：各席别价格"（x）

3. 登录页 (P003)
   3.1 用户登录 (F005)
   - "账号密码登录：支持用户名、手机号、邮箱输入"（√）
   - "密码输入支持显示/隐藏切换"（√）
   - “忘记密码功能”（√）
   - "忘记密码第一层检测输出的邮箱/手机号——身份证组合是否在数据库中"（√）
   - “忘记密码第二次使用验证码检验”（√）
   - "可切换扫码登录和账号登录模式（但扫码模式目前不支持）"（√）
   - "登录成功跳转首页 P001"（√）
   - "点击注册按钮跳转注册页 P004"（√）

   - “账户不存在提示用户注册”（？目前只有登录失败，请重试）
   - "连续失败≥3 次启用图形验证码"（x，目前不准备实现）

4. 注册页 (P004)
   4.1 用户注册 (F006)
   - "手机号 11 位格式验证"（√）
   - "检查手机号, 邮箱号，身份证号是否已注册"（√）
   - "发送验证码并显示 60 秒倒计时"（√）
   - "验证码为 6 位数字，5 分钟有效期"（？，有效期待定）
   - "验证码验证成功后才可继续"（√）
   - "重新发送验证码后上个验证码失效"（√）
   - "密码设置 6-20 位字符"（√）
   - "密码必须包含字母与数字"（x，可后续实现）
   - "密码强度提示（弱/中/强）"（√）
   - "身份证号码检验"（√）
   - "确认密码二次验证"（√）
   - "确认勾选服务条款"（√）
   - "前端数据验证后由后端创建账户"（√）
   - "注册成功信息提示（跳转登录页）"（√）

5. 订单填写页 (P005)
   5.1 订单显示 (F007)
   - "显示车次信息：车次号、发到站、时间"（√）
   - "显示可用席别及余票数量、价格"（√）
   - "选择席别且不可选无票席别（但默认选项可能无票）"（√）
   - "席位选择：二等座、一等座、商务座"（√）
   - "加载常用乘车人列表（来自乘客管理）"（√）
   - "乘车人多选支持"（支持多选但未限制上限）
   - "证件类型适配（身份证/护照等）"（√，现为身份证）
   - "显示订单明细：车次、席别（x）、乘车人、总价"（部分完成）
   - "提交预订请求，锁票成功跳转 P005"（√）

   - "票种选择：成人票、儿童票、学生票"（x）
   - "证件有效期校验"（x）
   - "勾选购票协议后方可提交"（x）
   - "网络中断保存草稿并支持稍后恢复"（x）
   - "验证乘车人信息完整性"（？）
   - "显示锁票时间提示（通常 15 分钟）"（x）

   
   5.2 提交订单 (F008)
   - "检查所有必填项完整性"（√）
   - "验证证件号格式正确"（√）
   - "检查余票是否仍然充足"（√）
   - "计算总价（多票）" （√）
   - "生成唯一订单号"（√）
   - "创建订单记录并关联乘车人信息"（√）
   - "提交订单后跳转P006个人中心-订单管理"（√）

   - "设置支付超时时间为 30 分钟"（？似乎后端有实现但前端尚未测试）
   - "确认订单未超时"（x）
   - "锁定座位资源"（x）
   - "重复提交防抖处理（提交后禁用按钮）"（x）

6. 个人中心 (P006)
   6.1 个人信息管理 (F009)
   - 显示基本信息：用户名（不可修改） √
   - 显示真实姓名 √
   - 显示身份证号 √
   - 显示手机号 √
   - 显示邮箱 √
   - 显示账户信息：注册时间与最后登录时间 √
   - 修改密码功能 √
   - 修改密码：输入旧密码 √
   - 修改密码：输入新密码（强度验证）并确认 √
   
   - 显示账户等级与积分 x, 没必要
   - 显示实名认证状态 x, 没必要


   6.2 乘客管理 (F010)
   - 显示所有常用乘车人列表 √
   - 乘车人卡片显示：姓名、证件类型与号码，手机号 √
   - 旅客类型：成人/儿童/学生 √
   - 设为默认、编辑、删除按钮 √
   - 默认乘车人标识 √
   - 新增乘车人：输入基本信息  √
   - 新增乘车人：选择证件类型（身份证） √
   - 新增乘车人：填写证件号码及手机号 √
   - 证件校验：身份证 18 位格式与校验位验证 √（后端校验）
   - 证件校验：护照/通行证格式验证 √（后端校验）

   - 实时验证反馈 x

   6.3 订单管理 (F011)
   - 无订单时点击“立刻订票”跳转P002（订单填写页） √
   - 订单状态筛选：全部、待支付、已支付、已完成、已取消（未完成） √
   - 订单卡片显示订单号 √
   - 订单卡片显示车次信息（出发地→目的地） √
   - 订单卡片显示出发时间 √
   - 订单卡片显示乘车人姓名 √
   - 订单卡片显示金额与状态标签 √
   - 订单卡片提供操作按钮（随状态变化） √
   - 按创建时间倒序（默认） √
   - 点击订单卡片可展开详情（不过没想好具体展示什么信息） √
   - 待支付：立即支付跳转支付流程 √
   - 待支付：取消订单需确认弹窗 √

   - 时间范围筛选：近一个月、三个月、半年、自定义 x
   - 搜索框支持订单号与车次号 x
   - 分页每页显示 10 条 x（后端支持分页，前端未提供分页控件）

   6.4 订单支付 (F012)
   - "支付方式：微信扫码支付（PC）"（√）
   - "支付方式：支付宝扫码支付（PC）"（√）
   - 模拟支付成功与失败（√）
   - 支付失败：ui显示失败并返回支付界面（√）
   - 支付成功：ui显示成功并回到订单管理页（√）
   - "支付确认显示订单号"（√）
   - "支付确认显示订单金额"（√）
   - "支付成功后更新订单状态"（√）
   - "创建支付订单"（√）

   - "调起支付接口并跳转第三方支付页面"（x）
   - "轮询支付状态（最多 3 分钟）"（x）
   - "显示支付成功页面"（x）
   - "显示支付失败原因"（x）
   - "支付倒计时 30 分钟"（x）
   
   6.5 用户登出 (F013)
   - "触发方式：点击导航栏退出登录"（√）
   - "清除本地 token"（√）
   - "清除 session 及用户缓存信息"（√）
   - "跳转首页P001并更新导航栏状态"（√）
   - "网络异常时本地强制登出"（√）

   - "触发方式：个人中心安全退出"（x）
   - "登出确认弹窗（可选）"（x）
   - "记录登出日志并通知后端使 token 失效"（x）


   6.6 车票改签 (F014)（X）
   - "资格校验：订单为已支付且未使用"（x）
   - "资格校验：部分车票不可改签"（x）
   - "资格校验：检查改签次数（限改签 1 次）"（x）
   - "资格校验：检查时间限制（开车前 30 分钟）"（x）
   - "显示改签规则说明"（x）
   - "默认显示同一路线车次"（x）
   - "筛选条件：日期范围（前后 3 天）"（x）
   - "显示可改签车次与余票信息"（x）
   - "差价计算：补差价、退差价或无需补退"（x）
   - "确认改签协议并提交改签请求"（x）
   - "改签成功显示新订单信息并将原订单标记为已改签"（x）
   - "新车次余票不足提示选择其他车次"（x）
   

