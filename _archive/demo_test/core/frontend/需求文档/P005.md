# 测试覆盖率追踪报告

## 概览与配比
- 总子需求数: 15 (针对 P005 模块)
- 当前规划统计（近似值）:
  - Unit: ≈2
  - Component: ≈9
  - Integration: ≈3
  - E2E: ≈1

## src/pages/P005/OrderConfirmationPage.jsx

### ✅ 单元测试 (Unit)
- 倒计时计算逻辑 (tests/frontend/pages/P005_Order/unit/countdown.spec.ts)
- 验证根据订单创建时间和当前时间计算剩余支付时间的函数逻辑正确性
- 验证超时后返回0或特定标识

### 🧩 组件测试 (Component)
- 数据加载状态 (tests/frontend/pages/P005_Order/component/loading_render.spec.tsx)
- 验证组件挂载初期在未获取到订单详情时显示Loading指示器
- 订单详情渲染 (tests/frontend/pages/P005_Order/component/details_render.spec.tsx)
- 验证Mock数据中的车次信息(G1024)、出发到达站、乘车人列表正确显示
- 验证订单总金额显示正确且格式化为货币形式(如¥100.00)
- 异常状态处理 (tests/frontend/pages/P005_Order/component/error_state.spec.tsx)
- 模拟API返回404(订单不存在)验证页面显示“订单不存在”或返回上一页按钮
- 模拟订单状态为“已取消”验证页面显示相应的状态提示而非支付按钮
- 确认支付交互 (tests/frontend/pages/P005_Order/component/confirm_action.spec.tsx)
- 验证点击“立即支付”按钮后触发导航逻辑

### 🔗 集成测试 (Integration)
- 确认页初始化流程 (tests/frontend/pages/P005_Order/integration/init_flow.spec.tsx)
- 验证页面加载时调用获取订单详情API
- 验证API调用成功后页面从Loading状态切换为内容展示状态
- 验证点击支付按钮跳转至/payment/:orderId路径

## src/pages/P005/PaymentPage.jsx

### 🧩 组件测试 (Component)
- 支付信息展示 (tests/frontend/pages/P005_Payment/component/info_display.spec.tsx)
- 验证页面正确显示订单号和待支付金额
- 支付方式选择 (tests/frontend/pages/P005_Payment/component/method_select.spec.tsx)
- 验证默认选中某一种支付方式(如微信支付)
- 验证点击“支付宝”选项后选中状态发生切换
- 支付按钮交互 (tests/frontend/pages/P005_Payment/component/pay_button.spec.tsx)
- 验证点击“确认支付”按钮后按钮进入Loading状态
- 验证支付过程中禁用支付方式切换

### 🔗 集成测试 (Integration)
- 支付成功流程 (tests/frontend/pages/P005_Payment/integration/pay_success.spec.tsx)
- 点击支付 -> Mock支付API返回成功 -> 验证路由跳转至/payment-success/:orderId
- 支付失败流程 (tests/frontend/pages/P005_Payment/integration/pay_failure.spec.tsx)
- 点击支付 -> Mock支付API返回失败 -> 验证页面弹出错误提示Toast且停留在当前页

## src/pages/P005/PaymentSuccessPage.jsx

### 🧩 组件测试 (Component)
- 成功结果渲染 (tests/frontend/pages/P005_Success/component/result_render.spec.tsx)
- 验证页面显示“支付成功”的大图标和提示文本
- 验证正确回显订单号和支付金额
- 导航链接验证 (tests/frontend/pages/P005_Success/component/nav_links.spec.tsx)
- 验证“查看订单”按钮点击后导航至/my-orders或订单详情页
- 验证“返回首页”按钮点击后导航至/路径

### 🔗 集成测试 (Integration)
- 状态二次确认 (tests/frontend/pages/P005_Success/integration/status_check.spec.tsx)
- (可选)验证页面加载时是否再次调用后端接口确认订单确实已变为“已支付”状态以防止直接访问URL造假

### 🚀 E2E 测试 (Playwright)
- 支付全流程 (tests/e2e/payment_flow.spec.ts)
- 进入订单确认页 -> 核对信息点击支付 -> 在支付页选择方式点击支付 -> 验证最终跳转至支付成功页